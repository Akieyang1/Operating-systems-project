# Operating-systems-project

### **LO03 项目 2024-2025**  
### **任务调度器编程**  

---

### **1 功能与语法**

- **pcron 命令**：用于让系统执行提前定义和计划的所有任务（命令和脚本）。这些任务可以是简单的命令，也可以是复杂的脚本，能够在固定时间执行，甚至周期性执行，并生成日志报告。

- **文件监控**：pcron 命令会定期读取位于 **/etc/pcron/** 目录和 **/etc/pcrontab** 文件中的内容，以判断是否需要执行某些任务。

- **日志记录**：每次执行 pcron 操作时，都会向 **/var/log/pcron** 文件添加一条日志记录。

- **标准输出**：默认情况下，pcron 执行的命令产生的输出会被发送到标准输出。

- **用户权限**：pcron 命令通常仅限管理员使用。不过，特定用户也可以被授权使用。授权用户列表保存在 **/etc/pcron.allow** 文件中，未授权用户列表则保存在 **/etc/pcron.deny** 文件中。  
    示例：仅用户 Jean 和 Charles 被允许使用 pcron 服务：
    ```bash
    $ cat pcron.allow  
    Jean  
    Charles  
    ```

- **pcrontab 命令**：用于为 pcron 服务编程，语法如下：  
    ```bash
    pcrontab [-u user] {-l | -r | -e}
    ```
    - `pcrontab -u toto -l`：显示用户 toto 的 pcrontab 文件，文件位于 **/etc/pcron/**。  
    - `pcrontab -u toto -r`：删除用户 toto 的 pcrontab 文件。  
    - `pcrontab -u toto -e`：创建或编辑用户 toto 的 pcrontab 文件。修改时会在 **/tmp** 目录中打开临时文件，保存后写入 **/etc/pcron/pcrontabtoto**。

- **pcrontab 文件**：每行包含 **7 个字段**，前 6 个字段表示任务的执行时间，第 7 个字段表示要执行的命令（可以是脚本）。  
    - **字段说明**：  
      1. 15 秒（0-3）  
      2. 分钟（0-59）  
      3. 小时（0-23）  
      4. 月内日期（1-31）  
      5. 月份（1-12）  
      6. 星期（0-6，0 表示周日）  

    - **字段格式**：  
        - **单一值**：例如 `15` 表示分钟字段中的第 15 分钟。  
        - **值列表**：例如 `1:3:5` 表示多个有效值（1、3 和 5）。  
        - **时间范围**：例如 `1-5` 表示从周一到周五。  
        - **星号（*）**：表示字段的所有可能值。  
        - **步长值**：例如 `*/4` 表示每隔 4 小时执行一次。  
        - **排除值**：使用 `~` 排除指定值，例如 `5-8~6~7` 等价于 `5:8`。  

- **示例任务**：  
    - 每 4 小时执行一次，日期是每月的 1 日和 15 日：  
      ```bash
      0 0 */4 1,15 * * 命令
      ```
    - 每月 1 日和 15 日凌晨 2:30:30 重启机器：  
      ```bash
      2 30 2 1,15 * * /sbin/shutdown -r
      ```
    - 每周一凌晨 3:15 执行备份脚本：  
      ```bash
      0 15 3 * * 1 /usr/bin/backup
      ```
    - 每隔 15 秒执行一次：  
      ```bash
      1 * * * * * 命令
      ```
    - 每周一到周五早上 7:30 执行：  
      ```bash
      0 30 7 * * 1-5 命令
      ```
    - 每小时的 15 分、30 分、45 分在指定时间段执行：  
      ```bash
      0 0,15,30,45 15-19 1-15 1-12~4~5 1-5 命令
      ```
    - 每月 1 日凌晨 2:00 清理 `/tmp` 目录中过期 3 天的文件：  
      ```bash
      0 0 2 1 * * find /tmp -atime 3 -exec rm -f {}\;
      ```

---

### **2 说明**  

与现有任务调度工具（如 crontab、anacron、fcron 等）或其衍生品的相似之处纯属巧合。因此，**不建议**在项目中使用这些工具完成任务。

---

### **3 扩展**  

所有与项目相关的扩展都欢迎提出。用户界面设计可由你自行决定。

---

### **4 报告与展示**  

- 项目必须由三人小组共同完成。  
- **截止日期**：2025 年 2 月 24 日（周一）前需提交一份最终报告。  
- **展示与测试**：将在 2025 年 2 月 24 日至 27 日之间的最后一周进行，持续 15 分钟。  
